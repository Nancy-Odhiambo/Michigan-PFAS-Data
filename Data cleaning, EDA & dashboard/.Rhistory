theme(legend.position = "right",
axis.text = element_text(color = "black"),
axis.ticks = element_line(color = "black"))
# Plot showing the pfas sites in Michigan
pfas_sites_sf <- pfas_sites |>
st_as_sf(coords = c("longitude", "latitude"), crs = 4326) |>
mutate(type = str_replace_all(type, "mlitary", "military"),
type = str_to_title(type))
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_sf(data = pfas_sites_sf, aes(color = type), size = 1.5, alpha = 0.7) +
scale_color_viridis_d() +
labs(
title = "PFAS Sites Across Michigan",
color = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal()
# Plotting the pfas sites with hazard index greater than 1 as per regulations
# Convert geoid to character for joining
pfas_sites <- pfas_sites |>
mutate(geoid = as.character(geoid))
# Join datasets allowing many-to-many
merged_data <- public_water_max_long |>
left_join(pfas_sites, by = "geoid", relationship = "many-to-many")
# Aggregating to one row per hex_id for mapping
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Selecting the correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Plot with color and size for Hazard_Index
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf, aes(color = Hazard_Index, size = Hazard_Index)) +
scale_color_viridis_c(option = "viridis") +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Hazard Index size and scale",
color = "Hazard Index",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right")
# Plotting PFAS sites by type and the Hazard_Index scale
# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "viridis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 10))
# Mean hazard index by type of site and number of sites
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, Hazard_Index)
# Aggregate mean Hazard_Index and count of sites by site type
mean_by_type <- hazard_data |>
group_by(type) |>
summarise(mean_hazard = mean(Hazard_Index, na.rm = TRUE),
n_sites = n(),
.groups = "drop")
# Order types by mean hazard descending
top_types <- mean_by_type |>
arrange(desc(mean_hazard)) |>
slice_head(n = 10)
# Prepare plot data with factor levels for ordering
plot_data <- mean_by_type |>
filter(type %in% top_types$type) |>
mutate(type = factor(type, levels = top_types$type))
# Plot mean Hazard_Index by site type with site count labels
ggplot(plot_data, aes(x = type, y = mean_hazard, fill = type)) +
geom_col(position = position_dodge(width = 0.7), width = 0.7) +
geom_text(aes(label = n_sites), vjust = -0.5, size = 3.5) +
scale_fill_viridis_d(option = "viridis") +
labs(title = "Mean Hazard Index by Site Type (Hazard_Index > 1)",
x = "Site Type",
y = "Mean Hazard Index",
fill = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART)",
subtitle = "Numbers above bars indicate number of sites per type") +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
# Visualizing the type of site by the composition of 4 main analytes with the hazard index
# Filter merged_data for Hazard_Index > 1, remove NA types, keep only main analytes
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, analyte, analyte_value, Hazard_Index) |>
filter(analyte %in% hazard_analytes)
# Summarise total hazard and analyte sums by type (then pivot to wide)
hazard_summary_by_type <- hazard_data |>
group_by(type, analyte) |>
summarise(
sum_analyte = sum(analyte_value, na.rm = TRUE),
.groups = "drop"
) |>
# Add total hazard per type
left_join(
hazard_data |>
group_by(type) |>
summarise(
total_hazard = sum(Hazard_Index, na.rm = TRUE),
n_sites = n_distinct(hex_id),
.groups = "drop"
),
by = "type"
) |>
# Pivot analytes to columns (wide format)
pivot_wider(
names_from = analyte,
values_from = sum_analyte,
values_fill = 0
) |>
arrange(desc(total_hazard))
# View as a table
hazard_summary_by_type |>
flextable() |>
set_caption("Total Hazard and Main Analytes Distribution by Site Type (Hazard_Index > 1) - Wide Format") |>
autofit()
# Visualizing the type of site by the composition of 4 main analytes with the hazard index
# Filter merged_data for Hazard_Index > 1, remove NA types, keep only main analytes
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, analyte, analyte_value, Hazard_Index) |>
filter(analyte %in% hazard_analytes)
# Summarise total hazard and analyte sums by type
hazard_summary_by_type <- hazard_data |>
group_by(type, analyte) |>
summarise(
sum_analyte = sum(analyte_value, na.rm = TRUE),
.groups = "drop"
) |>
# Total hazard per type
left_join(
hazard_data |>
group_by(type) |>
summarise(
total_hazard = sum(Hazard_Index, na.rm = TRUE),
n_sites = n_distinct(hex_id),
.groups = "drop"
),
by = "type"
) |>
# Pivot analytes to columns
pivot_wider(
names_from = analyte,
values_from = sum_analyte,
values_fill = 0
) |>
arrange(desc(total_hazard))
# View as a table
hazard_summary_by_type |>
flextable() |>
set_caption("Total Hazard and Main Analytes Distribution by Site Type (Hazard_Index > 1) - Wide Format") |>
autofit()
getwd()
getwd()
# List of datasets and desired CSV names
datasets <- list(
surface_water_long = surface_water_long,
surface_max_full = surface_max_full,
surface_water_dictionary = surface_water_dictionary,
clean_surface_water_dictionary = clean_surface_water_dictionary,
public_water_long = public_water_long,
public_max_full = public_max_full,
clean_public_water_dictionary = clean_public_water_dictionary,
pfas_sites = pfas_sites,
pfas_sites_descriptions = pfas_sites_descriptions
)
# Dashboard folder
dashboard <- "/Users/nancyodhiambo/Library/CloudStorage/OneDrive-GrandValleyStateUniversity/Projects/Michigan_PFAS/Data cleaning, EDA & dashboard/dashboard"
# Loop to save each dataset as CSV
for(name in names(datasets)) {
write.csv(datasets[[name]], file = file.path(dashboard_folder, paste0(name, ".csv")), row.names = FALSE)
}
# List of datasets and desired CSV names
datasets <- list(
surface_water_long = surface_water_long,
surface_max_full = surface_max_full,
surface_water_dictionary = surface_water_dictionary,
clean_surface_water_dictionary = clean_surface_water_dictionary,
public_water_long = public_water_long,
public_max_full = public_max_full,
clean_public_water_dictionary = clean_public_water_dictionary,
pfas_sites = pfas_sites,
pfas_sites_descriptions = pfas_sites_descriptions
)
# Dashboard folder
dashboard <- "/Users/nancyodhiambo/Library/CloudStorage/OneDrive-GrandValleyStateUniversity/Projects/Michigan_PFAS/Data cleaning, EDA & dashboard/dashboard"
# Loop to save each dataset as CSV
for(name in names(datasets)) {
write.csv(datasets[[name]], file = file.path(dashboard, paste0(name, ".csv")), row.names = FALSE)
}
# Saving all used datasets in the dashboard folder for direct access
# List of datasets and desired CSV names
datasets <- list(
surface_water_long_2 = surface_water_long,
surface_water_dictionary_2 = surface_water_dictionary,
public_water_long_2 = public_water_long,
public_water_wide_2 = public_water_wide,
public_water_max_2 = public_water_max,
public_water_max_long_2 = public_water_max_long,
pfas_sites_2 = pfas_sites
)
# Dashboard folder
dashboard <- "/Users/nancyodhiambo/Library/CloudStorage/OneDrive-GrandValleyStateUniversity/Projects/Michigan_PFAS/Data cleaning, EDA & dashboard/dashboard"
# Loop to save each dataset as CSV
for(name in names(datasets)) {
write.csv(datasets[[name]], file = file.path(dashboard, paste0(name, ".csv")), row.names = FALSE)
}
# Copy shapefile and its associated files to dashboard folder
shp_files <- list.files("GeoFiles", pattern = "cb_2018_us_county_500k.*", full.names = TRUE)
file.copy(shp_files, dashboard, overwrite = TRUE)
#| include: false
library(shiny)
#| include: false
library(shiny)
install.packages(c("shiny", "DT", "ggplot2", "dplyr", "leaflet"))
install.packages("shiny")
#| include: false
library(shiny)
library(DT)
install.packages("DT")
#| include: false
library(shiny)
library(DT)
library(ggplot2)
library(dplyr)
library(leaflet)
# Define the UI
ui <- fluidPage(
titlePanel("Michigan PFAS Data Dashboard"),
sidebarLayout(
sidebarPanel(
radioButtons(
inputId = "section",
label = "Select Section:",
choices = c(
"ReadMe" = "readme",
"Metrics/Tables" = "metrics",
"Exploratory Data Analysis" = "eda",
"In-depth Hazard Index Analysis and Key Takeaways/Insights" = "hazard"
),
selected = "readme"
)
),
mainPanel(
uiOutput("section_ui")
)
)
)
# Define the server
server <- function(input, output) {
output$section_ui <- renderUI({
switch(input$section,
"readme" = {
tagList(
h3("ðŸ“˜ ReadMe"),
p("This dashboard provides an overview and analysis of PFAS data in Michigan."),
p("Sections:"),
tags$ul(
tags$li("Metrics/Tables â€“ Summary statistics and data tables"),
tags$li("Exploratory Data Analysis â€“ Visual insights and spatial trends"),
tags$li("In-depth Hazard Index Analysis â€“ Risk assessment and interpretation")
)
)
},
"metrics" = {
tagList(
h3("ðŸ“Š Metrics and Tables"),
p("Summary metrics and sample data tables for PFAS data."),
dataTableOutput("summary_table")
)
},
"eda" = {
tagList(
h3("ðŸ” Exploratory Data Analysis"),
p("Visual exploration of PFAS concentrations across locations."),
plotOutput("eda_plot"),
leafletOutput("eda_map", height = 400)
)
},
"hazard" = {
tagList(
h3("âš ï¸ In-depth Hazard Index Analysis and Insights"),
plotOutput("hazard_plot"),
p("Key Takeaways and Insights:"),
tags$ul(
tags$li("Sites exceeding PFAS thresholds require urgent attention."),
tags$li("Certain regions show consistent high-risk profiles."),
tags$li("Regulatory measures can prioritize hotspot areas for remediation.")
)
)
}
)
})
# Example server logic placeholders
output$summary_table <- renderDataTable({
head(mtcars)  # Replace with your PFAS summary dataset
})
output$eda_plot <- renderPlot({
ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_point(color = "steelblue") +
theme_minimal() +
labs(title = "Sample EDA Plot", x = "Weight", y = "MPG")
})
output$eda_map <- renderLeaflet({
leaflet() %>%
addTiles() %>%
addMarkers(lng = -84.5555, lat = 42.7339, popup = "Example Site - Lansing, MI")
})
output$hazard_plot <- renderPlot({
ggplot(mtcars, aes(x = factor(cyl), y = mpg, fill = factor(cyl))) +
geom_boxplot() +
theme_minimal() +
labs(title = "Sample Hazard Index Analysis", x = "Cylinder Category", y = "Index Value")
})
}
# Run the Shiny app
shinyApp(ui, server)
#| include: false
library(shiny)
library(DT)
library(ggplot2)
library(dplyr)
library(leaflet)
# Load PFAS datasets from current folder
# EDA datasets
surface_water_long <- read.csv("surface_water_long.csv")
surface_max_full <- read.csv("surface_max_full.csv")
surface_water_dictionary <- read.csv("surface_water_dictionary.csv")
clean_surface_water_dictionary <- read.csv("clean_surface_water_dictionary.csv")
public_water_long <- read.csv("public_water_long.csv")
public_max_full <- read.csv("public_max_full.csv")
clean_public_water_dictionary <- read.csv("clean_public_water_dictionary.csv")
pfas_sites <- read.csv("pfas_sites.csv")
pfas_sites_descriptions <- read.csv("pfas_sites_descriptions.csv")
# Hazard Index datasets
surface_water_long_2 <- read.csv("surface_water_long_2.csv")
surface_water_dictionary_2 <- read.csv("surface_water_dictionary_2.csv")
public_water_long_2 <- read.csv("public_water_long_2.csv")
public_water_wide_2 <- read.csv("public_water_wide_2.csv")
public_water_max_2 <- read.csv("public_water_max_2.csv")
public_water_max_long_2 <- read.csv("public_water_max_long_2.csv")
pfas_sites_2 <- read.csv("pfas_sites_2.csv")
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
Rcpp::sourceCpp("dashboard/CSS.cpp")
ui <- fluidPage(
tags$head(
tags$link(rel = "stylesheet", type = "text/css", href = "styles.css")
),
tags$h1("Michigan PFAS Data Dashboard"),
div(class = "nav-bar",
div(class = "nav-links",
actionLink("readme", "ðŸ“˜ ReadMe"),
actionLink("metrics", "ðŸ“Š Metrics/Tables"),
actionLink("eda", "ðŸ” Exploratory Data Analysis"),
actionLink("hazard", "âš ï¸ Hazard Index Analysis"),
actionLink("keytakeaways", "ðŸ“ Key Takeaways & Insights")
)
),
fluidRow(
column(12,
div(uiOutput("section_ui"),
style = "width:100%; padding:0 20px;")
)
)
)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
#| include: false
library(shiny)
library(DT)
library(ggplot2)
library(dplyr)
library(leaflet)
# Load PFAS datasets
# EDA datasets
surface_water_long <- read.csv("surface_water_long.csv")
surface_max_full <- read.csv("surface_max_full.csv")
surface_water_dictionary <- read.csv("surface_water_dictionary.csv")
clean_surface_water_dictionary <- read.csv("clean_surface_water_dictionary.csv")
public_water_long <- read.csv("public_water_long.csv")
public_max_full <- read.csv("public_max_full.csv")
clean_public_water_dictionary <- read.csv("clean_public_water_dictionary.csv")
pfas_sites <- read.csv("pfas_sites.csv")
pfas_sites_descriptions <- read.csv("pfas_sites_descriptions.csv")
# Hazard Index datasets
surface_water_long_2 <- read.csv("surface_water_long_2.csv")
surface_water_dictionary_2 <- read.csv("surface_water_dictionary_2.csv")
public_water_long_2 <- read.csv("public_water_long_2.csv")
public_water_wide_2 <- read.csv("public_water_wide_2.csv")
public_water_max_2 <- read.csv("public_water_max_2.csv")
public_water_max_long_2 <- read.csv("public_water_max_long_2.csv")
pfas_sites_2 <- read.csv("pfas_sites_2.csv")
ui <- fluidPage(
tags$head(
tags$link(rel = "stylesheet", type = "text/css", href = "styles.css")
),
# Title
tags$h1("Michigan PFAS Data Dashboard", class = "dashboard-title"),
# Navigation bar
div(class = "nav-bar",
div(class = "nav-links",
actionLink("readme", "ðŸ“˜ ReadMe"),
actionLink("metrics", "ðŸ“Š Metrics/Tables"),
actionLink("eda", "ðŸ” Exploratory Data Analysis"),
actionLink("hazard", "âš ï¸ Hazard Index Analysis"),
actionLink("keytakeaways", "ðŸ“ Key Takeaways & Insights")
)
),
# Main content
fluidRow(
column(12,
div(uiOutput("section_ui"),
style = "width:100%; padding:0 20px;")
)
)
)
server <- function(input, output, session) {
selected_section <- reactiveVal("readme")  # Default section
observeEvent(input$readme, { selected_section("readme") })
observeEvent(input$metrics, { selected_section("metrics") })
observeEvent(input$eda, { selected_section("eda") })
observeEvent(input$hazard, { selected_section("hazard") })
observeEvent(input$keytakeaways, { selected_section("keytakeaways") })
output$section_ui <- renderUI({
switch(selected_section(),
"readme" = tagList(
h3("ðŸ“˜ ReadMe"),
p("This dashboard provides an overview and analysis of PFAS data in Michigan."),
tags$ul(
tags$li("Metrics/Tables â€“ Summary statistics and data tables"),
tags$li("Exploratory Data Analysis â€“ Visual insights and spatial trends"),
tags$li("In-depth Hazard Index Analysis â€“ Risk assessment and interpretation")
)
),
...
)
})
}
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
# Run the Shiny app
shinyApp(ui, server)
