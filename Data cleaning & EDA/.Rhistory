# Compute centroids for labeling
county_centroids <- st_centroid(mi_surface_map)
# Plot
ggplot(mi_surface_map) +
geom_sf(aes(fill = mean_value), color = "white") +
geom_text_repel(data = county_centroids, aes(label = initials, geometry = geometry),
stat = "sf_coordinates", size = 5, fontface = "bold", color = "black") +
scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
labs(
title = "Mean PFAS Concentration in Surface Water by County",
x = "Longitude", y = "Latitude",
fill = "Mean PFAS (ng/L)",
caption = "**Data source: Michigan EGLE PFAS Surface Water Dataset**"
) +
theme_minimal(base_size = 16) +
theme(legend.position = "bottom")
# Optional: save large clear plot
ggsave("Michigan_PFAS_map.png", width = 14, height = 12, dpi = 300)
# Boxplot of analyte values by watershed, faceted by analyte
surface_water_long |>
filter(analyte_value > 0)|>
ggplot(aes(x = fct_reorder(watershed, analyte_value, .fun = median),
y = analyte_value,
fill = watershed)) +
geom_boxplot() +
facet_wrap(~ analyte, scales = "free_y") +
labs(title = "Distribution of PFAS Analytes by Watershed",
x = "Watershed", y = "Analyte Value (ng/L)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
# Top 10 analytes by total concentration
surface_water_long %>%
filter(analyte_value > 0) %>%
group_by(analyte) %>%
summarize(total_concentration = sum(analyte_value, na.rm = TRUE), .groups = "drop") %>%
slice_max(total_concentration, n = 10) %>%
ggplot(aes(x = fct_reorder(analyte, total_concentration), y = total_concentration, fill = total_concentration)) +
geom_col() +
coord_flip() +
scale_fill_viridis_c(option = "plasma") +
labs(title = "Top 10 PFAS Analytes in Surface Water",
x = "Analyte", y = "Total Concentration (ng/L)") +
theme_minimal()
# Top 10 analytes by total concentration
surface_water_long %>%
filter(analyte_value > 0) %>%
group_by(analyte) %>%
summarize(total_concentration = sum(analyte_value, na.rm = TRUE), .groups = "drop") %>%
slice_max(total_concentration, n = 10) %>%
ggplot(aes(x = fct_reorder(analyte, total_concentration), y = total_concentration, fill = total_concentration)) +
geom_col() +
coord_flip() +
scale_fill_viridis_c(option = "plasma") +
labs(title = "Top 10 PFAS Analytes in Surface Water",
x = "Analyte", y = "Total Concentration (ng/L)") +
theme_minimal()+
theme(legend.position = "bottom")
# Choropleth of mean PFAS by county
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
surface_county_map <- surface_water_long %>%
group_by(geoid) %>%
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") %>%
left_join(mi_counties, by = c("geoid" = "GEOID")) %>%
st_as_sf()
ggplot(surface_county_map) +
geom_sf(aes(fill = mean_value), color = "white") +
scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
labs(title = "Mean PFAS Concentration in Surface Water by County",
fill = "Mean PFAS (ng/L)") +
theme_minimal()
# Boxplot of analyte values by system type
public_water_long |>
filter(analyte_value > 0) |>
ggplot(aes(x = fct_reorder(system_type, analyte_value, .fun = median),
y = analyte_value,
fill = system_type)) +
geom_boxplot() +
labs(title = "Distribution of PFAS Analytes by Public Water System Type",
x = "System Type", y = "Analyte Value (ng/L)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
# Bar plot of public water PFAS Concentration for the highest 15
public_water_top20 <- public_water_long |>
group_by(system_name) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE)) |>
ungroup() |>
slice_max(order_by = mean_value, n = 15)
ggplot(public_water_top20, aes(x = fct_reorder(system_name, mean_value), y = mean_value, fill = mean_value)) +
geom_col() +
coord_flip() +
scale_fill_viridis_c(option = "viridis") +
labs(
title = "Top 15 Public Water Systems by Mean PFAS",
x = "Public Water System",
y = "Mean PFAS (ng/L)",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(
legend.position = "bottom"
)
# Boxplot of analyte values by system type
public_water_long |>
filter(analyte_value > 0) |>
ggplot(aes(x = fct_reorder(system_type, analyte_value, .fun = median),
y = analyte_value,
fill = system_type)) +
geom_boxplot()
# Boxplot of analyte values by system type
public_water_long |>
filter(analyte_value > 0) |>
group_by(system_type) |>
filter(n() > 5) |>  # optional: remove system types with very few measurements
ungroup() |>
ggplot(aes(x = fct_reorder(system_type, analyte_value, .fun = median),
y = analyte_value,
fill = system_type)) +
geom_boxplot(outlier.shape = NA) +  # hide extreme outliers for clarity
geom_jitter(width = 0.2, alpha = 0.3, color = "black") +  # show points lightly
coord_flip() +  # horizontal boxplots
scale_y_continuous(trans = "log10") +  # log scale if wide range
labs(
title = "Distribution of PFAS Analytes by Public Water System Type",
x = "System Type",
y = "Analyte Value (ng/L, log scale)"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "none",
axis.text.y = element_text(size = 12)
)
# Map of average public water PFAS by county
public_county_map <- public_water_long |>
group_by(geoid) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
left_join(mi_counties, by = c("geoid" = "GEOID")) |>
st_as_sf()
ggplot(public_county_map) +
geom_sf(aes(fill = mean_value), color = "white") +
scale_fill_viridis_c(option = "magma", na.value = "grey90") +
labs(title = "Mean PFAS Concentration in Public Water by County",
fill = "Mean PFAS (ng/L)") +
theme_minimal()
# Bar plot showing the top 10 counties with the highest PFAS sites
sites_top10_counties <- pfas_sites |>
count(county, sort = TRUE) |>
slice_max(n, n = 10)  # top 10
ggplot(sites_top10_counties, aes(x = fct_reorder(county, n), y = n, fill = n)) +
geom_col() +
coord_flip() +
scale_fill_viridis_c(option = "viridis") +
scale_y_continuous(breaks = seq(0, max(sites_top10_counties$n, na.rm = TRUE), by = 5)) +
labs(
title = "Top 10 Counties by Number of PFAS Sites",
x = "County",
y = "Number of Sites",
fill = "Count",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(legend.position = "bottom")
# Map of PFAS sites by type
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_point(data = pfas_sites, aes(x = longitude, y = latitude, color = site_type), size = 2, alpha = 0.8) +
scale_color_viridis_d(option = "turbo") +
labs(title = "PFAS Sites in Michigan by Site Type",
color = "Site Type") +
theme_minimal()
# Map of PFAS sites by type
# Map of PFAS sites by type
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_point(
data = pfas_sites,
aes(x = longitude, y = latitude, color = type),  # <-- corrected column name
size = 2,
alpha = 0.8
) +
scale_color_viridis_d(option = "turbo") +
labs(
title = "PFAS Sites in Michigan by Site Type",
color = "Site Type"
) +
theme_minimal()
# Map of PFAS sites by type
# Summarize number of sites per longitude/latitude/type
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop")
# Get bounding box for Michigan counties
mi_bbox <- st_bbox(mi_counties)
# Map of PFAS sites with size scaled by count and transparency
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_point(
data = pfas_sites_summary,
aes(x = longitude, y = latitude, color = type, size = count),
alpha = 0.6
) +
scale_color_viridis_d(option = "turbo") +
scale_size_continuous(range = c(2, 6), guide = "legend") +
coord_sf(
xlim = c(mi_bbox["xmin"], mi_bbox["xmax"]),
ylim = c(mi_bbox["ymin"], mi_bbox["ymax"])
) +
labs(
title = "PFAS Sites in Michigan by Site Type",
color = "Site Type",
size = "Number of Sites"
) +
theme_minimal()
# Choropleth map of average PFAS concentrations (Surface Water) by county
# Load Michigan counties and filter for MI (state FIPS 26)
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Aggregate mean PFAS per county and join to shapefile
mi_surface_map <- surface_water_long |>
group_by(geoid) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
left_join(mi_counties, by = c("geoid" = "GEOID")) |>
st_as_sf() |>
mutate(initials = str_to_upper(str_extract_all(NAME, "\\b\\w", simplify = TRUE) |> apply(1, paste0, collapse = "")))
# Compute centroids for labeling
county_centroids <- st_centroid(mi_surface_map)
# Plot
ggplot(mi_surface_map) +
geom_sf(aes(fill = mean_value), color = "white") +
geom_text_repel(data = county_centroids, aes(label = initials, geometry = geometry),
stat = "sf_coordinates", size = 5, fontface = "bold", color = "black") +
scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
labs(
title = "Mean PFAS Concentration in Surface Water by County",
x = "Longitude", y = "Latitude",
fill = "Mean PFAS (ng/L)",
caption = "**Data source: Michigan EGLE PFAS Surface Water Dataset**"
) +
theme_minimal(base_size = 16) +
theme(legend.position = "bottom")
# Optional: save large clear plot
ggsave("Michigan_PFAS_map.png", width = 14, height = 12, dpi = 300)
# 1️⃣ Summarize surface water and public water by location
surface_water_summary <- surface_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Surface Water")
public_water_summary <- public_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Public Water")
# 2️⃣ Summarize PFAS sites
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop") |>
mutate(data_type = "PFAS Sites")
# 3️⃣ Prepare combined dataset for faceting
# For surface/public water, we use 'mean_value'; for PFAS sites, use 'count'
surface_water_summary <- surface_water_summary |>
rename(value = mean_value) |>
mutate(label = NA, type = NA)
public_water_summary <- public_water_summary |>
rename(value = mean_value) |>
mutate(label = NA, type = NA)
pfas_sites_summary <- pfas_sites_summary |>
rename(value = count, label = type)  # type as label for color
combined_data <- bind_rows(surface_water_summary, public_water_summary, pfas_sites_summary)
# 4️⃣ Get Michigan bounding box
mi_bbox <- st_bbox(mi_counties)
# 5️⃣ Plot faceted map
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_point(
data = combined_data,
aes(x = longitude, y = latitude, color = label, size = value),
alpha = 0.6
) +
scale_color_viridis_d(option = "turbo", na.value = "blue") +
scale_size_continuous(range = c(2, 6)) +
coord_sf(
xlim = c(mi_bbox["xmin"], mi_bbox["xmax"]),
ylim = c(mi_bbox["ymin"], mi_bbox["ymax"])
) +
facet_wrap(~data_type) +
labs(
title = "PFAS in Michigan: Surface Water, Public Water, and Sites",
color = "Site Type",
size = "Concentration / Count"
) +
theme_minimal() +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 12)
)
# Summarize surface water
surface_water_summary <- surface_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Surface Water")
# Summarize public water
public_water_summary <- public_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Public Water")
# Summarize PFAS sites
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop") |>
mutate(data_type = "PFAS Sites")
# Combine datasets
surface_water_summary <- surface_water_summary |>
rename(value = mean_value) |>
mutate(color_value = value, label = NA, size = value)
public_water_summary <- public_water_summary |>
rename(value = mean_value) |>
mutate(color_value = value, label = NA, size = value)
pfas_sites_summary <- pfas_sites_summary |>
rename(value = count, label = type, color_value = NA, size = count)
# Summarize surface water
library(dplyr)
library(ggplot2)
library(sf)
library(viridis)
# Summarize surface water
surface_water_summary <- surface_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Surface Water",
color_value = mean_value,
size = mean_value,
label = NA)
# Summarize public water
public_water_summary <- public_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(data_type = "Public Water",
color_value = mean_value,
size = mean_value,
label = NA)
# Summarize PFAS sites
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop") |>
mutate(data_type = "PFAS Sites",
size = count,
label = type)
# Combine datasets
combined_data <- bind_rows(
surface_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
public_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
pfas_sites_summary |> select(longitude, latitude, data_type, color_value = NA, size, label)
)
# Summarize surface water
library(dplyr)
library(ggplot2)
library(sf)
library(viridis)
# --- Summarize surface water ---
surface_water_summary <- surface_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(
data_type = "Surface Water",
color_value = mean_value,
size = mean_value,
label = NA
)
# --- Summarize public water ---
public_water_summary <- public_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(
data_type = "Public Water",
color_value = mean_value,
size = mean_value,
label = NA
)
# --- Summarize PFAS sites ---
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop") |>
mutate(
data_type = "PFAS Sites",
color_value = NA,    # add this column so bind_rows works
size = count,
label = type
)
# --- Combine datasets ---
combined_data <- bind_rows(
surface_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
public_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
pfas_sites_summary |> select(longitude, latitude, data_type, color_value, size, label)
)
# --- Michigan bounding box ---
mi_bbox <- st_bbox(mi_counties)
# --- Plot ---
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
# Surface & Public water points
geom_point(
data = combined_data |> filter(data_type != "PFAS Sites"),
aes(x = longitude, y = latitude, color = color_value, size = size),
alpha = 0.6
) +
# PFAS sites points
geom_point(
data = combined_data |> filter(data_type == "PFAS Sites"),
aes(x = longitude, y = latitude, color = label, size = size),
alpha = 0.8
) +
# Scales
scale_color_viridis_c(option = "viridis", na.value = "grey") + # for water
scale_size_continuous(range = c(2, 6)) +
# Separate facet per data type
facet_wrap(~data_type) +
# Coordinate limits
coord_sf(
xlim = c(mi_bbox["xmin"], mi_bbox["xmax"]),
ylim = c(mi_bbox["ymin"], mi_bbox["ymax"])
) +
# Labels and theme
labs(
title = "PFAS in Michigan: Surface Water, Public Water, and Sites",
size = "Concentration / Count",
color = "Concentration / Type"
) +
theme_minimal() +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 12)
)
# Summarize surface water
library(dplyr)
library(ggplot2)
library(sf)
library(viridis)
# --- Summarize surface water ---
surface_water_summary <- surface_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(
data_type = "Surface Water",
color_value = mean_value,
size = mean_value,
label = NA
)
# --- Summarize public water ---
public_water_summary <- public_water_long |>
group_by(longitude, latitude) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(
data_type = "Public Water",
color_value = mean_value,
size = mean_value,
label = NA
)
# --- Summarize PFAS sites ---
pfas_sites_summary <- pfas_sites |>
group_by(longitude, latitude, type) |>
summarize(count = n(), .groups = "drop") |>
mutate(
data_type = "PFAS Sites",
color_value = NA,    # needed for bind_rows
size = count,
label = type
)
# --- Combine datasets ---
combined_data <- bind_rows(
surface_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
public_water_summary |> select(longitude, latitude, data_type, color_value, size, label),
pfas_sites_summary |> select(longitude, latitude, data_type, color_value, size, label)
)
# --- Michigan bounding box ---
mi_bbox <- st_bbox(mi_counties)
# --- Plot with separate color scales ---
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
# Water points (continuous color)
geom_point(
data = combined_data |> filter(data_type %in% c("Surface Water", "Public Water")),
aes(x = longitude, y = latitude, color = color_value, size = size),
alpha = 0.6
) +
# PFAS sites points (categorical color)
geom_point(
data = combined_data |> filter(data_type == "PFAS Sites"),
aes(x = longitude, y = latitude, color = label, size = size),
alpha = 0.8
) +
# Color scales
scale_color_viridis_c(option = "viridis", na.value = "grey", guide = "colorbar") + # continuous for water
scale_color_manual(values = viridis::viridis(length(unique(pfas_sites_summary$label)))) + # discrete for sites
# Size scale
scale_size_continuous(range = c(2, 6)) +
# Facet by data type
facet_wrap(~data_type) +
coord_sf(
xlim = c(mi_bbox["xmin"], mi_bbox["xmax"]),
ylim = c(mi_bbox["ymin"], mi_bbox["ymax"])
) +
labs(
title = "PFAS in Michigan: Surface Water, Public Water, and Sites",
size = "Concentration / Count",
color = "Concentration / Type"
) +
theme_minimal() +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 12)
)
