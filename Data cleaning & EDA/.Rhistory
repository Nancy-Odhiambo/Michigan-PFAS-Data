title = "Number of PFAS Sites by Type",
x = "Site Type",
y = "Number of Sites",
fill = "Count",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "none")
# Number of PFAS sites per type
pfas_sites |>
mutate(type = str_replace_all(type, "mlitary", "military"),
type = str_to_title(type)) |>
count(type, sort = TRUE) |>
ggplot(aes(x = fct_reorder(type, n), y = n, fill = n)) +
geom_col() +
geom_text(aes(label = n),
hjust = -0.05,  # slightly outside the bar
size = 3.5) +
coord_flip() +
scale_fill_viridis_c(option = "cividis") +
scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +  # add 15% space at top
labs(
title = "Number of PFAS Sites by Type",
x = "Site Type",
y = "Number of Sites",
fill = "Count",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "none")
# Aggregate surface water PFAS by county
surface_county <- surface_water_long |>
group_by(geoid) |>
summarize(mean_surface = mean(analyte_value, na.rm = TRUE),
n_surface_samples = n()) |>
ungroup()
# Aggregate public water PFAS by county
public_county <- public_water_long |>
group_by(geoid) |>
summarize(mean_public = mean(analyte_value, na.rm = TRUE),
n_public_samples = n()) |>
ungroup()
# Aggregate PFAS sites count by county
sites_county <- pfas_sites |>
group_by(geoid) |>
summarize(n_sites = n()) |>
ungroup()
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county |> mutate(geoid = as.character(geoid))
public_county  <- public_county  |> mutate(geoid = as.character(geoid))
sites_county   <- sites_county   |> mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county |>
full_join(public_county, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) |>
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table |>
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites")
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,  # removing the y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold"))
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites) |>
arrange(desc(total_surface))
# Flextable for top 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,  # remove y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),   # removes numeric x-axis ticks
axis.text.y = element_text(face = "bold") # keeps county names
)
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid") |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites) |>
slice_max(total_surface, n = 10)  # top 10 by surface PFAS
# Pivot longer for faceted plot
county_long <- county_combined |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = fct_reorder(NAME, value)) |>
ungroup()
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),   # remove numeric x-axis ticks
axis.text.y = element_text(face = "bold") # keep county names
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites) |>
arrange(desc(total_surface))
# Flextable for top 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,  # remove y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),   # removes numeric x-axis ticks
axis.text.y = element_text(face = "bold") # keeps county names
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites) |>
arrange(desc(total_surface))
# Flextable for top 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot and reorder per facet
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = fct_reorder(NAME, value)) |>  # reorder per facet
ungroup()
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),   # removes numeric x-axis ticks
axis.text.y = element_text(face = "bold") # keeps county names
)
# Total PFAS concentration by water type
total_pfas <- bind_rows(
surface_water_long |> summarize(total = sum(analyte_value, na.rm = TRUE)) |> mutate(water_type = "Surface Water"),
public_water_long  |> summarize(total = sum(analyte_value, na.rm = TRUE)) |> mutate(water_type = "Public Water")
) |>
mutate(pct = total / sum(total) * 100,
lbl = paste0(water_type, " (", round(pct, 1), "%)"))
# Pie chart
total_pfas |>
ggplot(aes(x = "", y = total, fill = water_type)) +
geom_col(width = 1, color = "white") +
coord_polar(theta = "y") +
geom_text(aes(label = lbl), position = position_stack(vjust = 0.5), size = 5) +
scale_fill_manual(values = c("Surface Water" = "steelblue", "Public Water" = "tomato")) +
labs(title = "Total PFAS Concentration by Water Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_void() +
theme(plot.title = element_text(face = "bold", size = 16),
plot.caption = element_text(face = "bold"))
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites)
# Flextable for top 10 counties by total_surface
top10_county_table <- county_summary |> slice_max(total_surface, n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
arrange(desc(value)) |>  # order within each facet
mutate(NAME = factor(NAME, levels = NAME)) |>  # fix factor levels per facet
ungroup()
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),   # removes numeric x-axis ticks
axis.text.y = element_text(face = "bold") # keeps county names
)
# Read county shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites)
# Flextable for top 10 counties by total_surface
top10_county_table <- county_summary |> slice_max(total_surface, n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
mutate(NAME = reorder_within(NAME, value, metric))  # reorder within facet
install.packages("tidytext")
library(tidytext)
# Read county shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Convert GEOID to character for joining
pfas_county_summary <- pfas_county_summary |> mutate(geoid = as.character(geoid))
public_county_totals <- public_water_long |>
group_by(geoid) |>
summarize(total_public = sum(analyte_value, na.rm = TRUE), .groups = "drop") |>
mutate(geoid = as.character(geoid))
sites_county <- pfas_sites |>
count(geoid) |>
rename(n_sites = n) |>
mutate(geoid = as.character(geoid))
# Combine totals by county
county_combined <- pfas_county_summary |>
select(geoid, total_value) |>
rename(total_surface = total_value) |>
full_join(public_county_totals, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary table with county names
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, total_surface, total_public, n_sites)
# Flextable for top 10 counties by total_surface
top10_county_table <- county_summary |> slice_max(total_surface, n = 10)
flextable(top10_county_table) |> autofit()
# Pivot longer for faceted bar plot
county_long <- top10_county_table |>
pivot_longer(cols = c(total_surface, total_public, n_sites),
names_to = "metric", values_to = "value") |>
mutate(NAME = reorder_within(NAME, value, metric))  # reorder within facet
# Custom labels for facets
metric_labels <- c(
total_surface = "Total Surface PFAS (ng/L)",
total_public = "Total Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
# Faceted bar plot
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_x_reordered() +  # handles reordered factor levels
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.x = element_blank(),
axis.text.y = element_text(face = "bold")
)
View(surface_water_long)
View(public_water_long)
View(public_max_full)
