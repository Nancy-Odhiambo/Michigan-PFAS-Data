names_to = "metric", values_to = "value") %>%
group_by(metric) %>%
mutate(NAME = reorder(NAME, value)) %>%
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
ggplot(county_long, aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15))) + # adds space for labels
labs(
x = "County",
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites"
) +
theme_minimal()
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") %>%
st_drop_geometry() %>%
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county %>% mutate(geoid = as.character(geoid))
public_county  <- public_county  %>% mutate(geoid = as.character(geoid))
sites_county   <- sites_county   %>% mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county %>%
full_join(public_county, by = "geoid") %>%
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined %>%
left_join(counties_sf, by = c("geoid" = "GEOID")) %>%
relocate(NAME, .before = geoid) %>%
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) %>%
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary %>% slice_head(n = 10)
flextable(top10_county_table) %>% autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table %>%
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") %>%
group_by(metric) %>%
mutate(NAME = reorder(NAME, value)) %>%
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
ggplot(county_long, aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), labels = NULL) + # remove y-axis labels
labs(
x = "County",
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Note: Data includes surface PFAS, public PFAS, and PFAS sampling sites"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold")
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") %>%
st_drop_geometry() %>%
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county %>% mutate(geoid = as.character(geoid))
public_county  <- public_county  %>% mutate(geoid = as.character(geoid))
sites_county   <- sites_county   %>% mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county %>%
full_join(public_county, by = "geoid") %>%
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined %>%
left_join(counties_sf, by = c("geoid" = "GEOID")) %>%
relocate(NAME, .before = geoid) %>%
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) %>%
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary %>% slice_head(n = 10)
flextable(top10_county_table) %>% autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table %>%
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") %>%
group_by(metric) %>%
mutate(NAME = reorder(NAME, value)) %>%
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
ggplot(county_long, aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), labels = NULL) + # remove y-axis labels
labs(
x = "County",
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold")
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") %>%
st_drop_geometry() %>%
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county %>% mutate(geoid = as.character(geoid))
public_county  <- public_county  %>% mutate(geoid = as.character(geoid))
sites_county   <- sites_county   %>% mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county %>%
full_join(public_county, by = "geoid") %>%
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined %>%
left_join(counties_sf, by = c("geoid" = "GEOID")) %>%
relocate(NAME, .before = geoid) %>%
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) %>%
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary %>% slice_head(n = 10)
flextable(top10_county_table) %>% autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table %>%
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") %>%
group_by(metric) %>%
mutate(NAME = reorder(NAME, value)) %>%
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
ggplot(county_long, aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), labels = NULL) + # remove y-axis numbers
labs(
x = "County",
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold")
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") %>%
st_drop_geometry() %>%
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county %>% mutate(geoid = as.character(geoid))
public_county  <- public_county  %>% mutate(geoid = as.character(geoid))
sites_county   <- sites_county   %>% mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county %>%
full_join(public_county, by = "geoid") %>%
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined %>%
left_join(counties_sf, by = c("geoid" = "GEOID")) %>%
relocate(NAME, .before = geoid) %>%
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) %>%
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary %>% slice_head(n = 10)
flextable(top10_county_table) %>% autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table %>%
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") %>%
group_by(metric) %>%
mutate(NAME = reorder(NAME, value)) %>%
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
ggplot(county_long, aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
labs(
x = "County",
y = NULL,  # removes the "Value" label
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold")
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county |> mutate(geoid = as.character(geoid))
public_county  <- public_county  |> mutate(geoid = as.character(geoid))
sites_county   <- sites_county   |> mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county |>
full_join(public_county, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) |>
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table |>
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites"
)
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +  # ensures labels outside bars are visible
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) + # removes y-axis numbers
labs(
x = "County",
y = NULL,  # removes the y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() |>
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold")
)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county |> mutate(geoid = as.character(geoid))
public_county  <- public_county  |> mutate(geoid = as.character(geoid))
sites_county   <- sites_county   |> mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county |>
full_join(public_county, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) |>
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table |>
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites")
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,  # removing the y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold"))
# Bar plots showing the surface water PFAS concentration by top and bottom 15 counties
pfas_county_summary <- surface_water_long |>
group_by(geoid) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE)) |>
ungroup() |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
rename(NAME = NAME)
# Top 15 counties
top15 <- pfas_county_summary |> slice_max(mean_value, n = 15) |> mutate(group = "Top 15")
# Bottom 15 counties
bottom15 <- pfas_county_summary |> slice_min(mean_value, n = 15) |> mutate(group = "Bottom 15")
# Combine the two
pfas_top_bottom <- bind_rows(top15, bottom15)
ggplot(pfas_top_bottom, aes(x = fct_reorder(NAME, mean_value),
y = mean_value,
fill = group)) +
geom_col() +
geom_text(aes(label = round(mean_value, 1)),
hjust = -0.05, size = 3.2) +
coord_flip() +
scale_fill_manual(values = c("Top 15" = "mediumseagreen", "Bottom 15" = "orange")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
facet_wrap(~group, scales = "free_y") +
labs(
title = "Surface Water PFAS by Top and Bottom 15 Counties",
x = "County",
y = "Mean PFAS (ng/L)",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(plot.title = element_text(face = "bold", size = 15),
axis.title.y = element_text(face = "bold"),
axis.title.x = element_text(face = "bold"),
plot.caption = element_text(face = "bold"),
legend.position = "none")
# Bar plots showing the surface water PFAS concentration by top and bottom 15 counties
# Load county shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Aggregate mean PFAS by county
pfas_county_summary <- surface_water_long |>
group_by(geoid) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE)) |>
ungroup() |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
rename(NAME = NAME)
# Top 15 counties
top15 <- pfas_county_summary |> slice_max(mean_value, n = 15) |> mutate(group = "Top 15")
# Bottom 15 counties
bottom15 <- pfas_county_summary |> slice_min(mean_value, n = 15) |> mutate(group = "Bottom 15")
# Combine
pfas_top_bottom <- bind_rows(top15, bottom15)
ggplot(pfas_top_bottom, aes(x = fct_reorder(NAME, mean_value),
y = mean_value,
fill = group)) +
geom_col() +
geom_text(aes(label = round(mean_value, 1)),
hjust = -0.05, size = 3.2) +
coord_flip() +
scale_fill_manual(values = c("Top 15" = "mediumseagreen", "Bottom 15" = "orange")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
facet_wrap(~group, scales = "free_y") +
labs(
title = "Surface Water PFAS by Top and Bottom 15 Counties",
x = "County",
y = "Mean PFAS (ng/L)",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(plot.title = element_text(face = "bold", size = 15),
axis.title.y = element_text(face = "bold"),
axis.title.x = element_text(face = "bold"),
plot.caption = element_text(face = "bold"),
legend.position = "none")
# Map of average surface water PFAS by county
# Load county shapefile
mi_counties <- st_read("cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Aggregate public water PFAS by county
public_county_map <- public_water_long |>
group_by(geoid) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE), .groups = "drop") |>
left_join(mi_counties, by = c("geoid" = "GEOID")) |>
st_as_sf()
ggplot(public_county_map) +
geom_sf(aes(fill = mean_value), color = "white") +
scale_fill_viridis_c(option = "magma", na.value = "grey90") +
labs(
title = "Mean PFAS Concentration in Public Water by County",
fill = "Mean PFAS (ng/L)",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal()
# Top 10 public water systems by mean PFAS
public_water_top10 <- public_water_long |>
group_by(system_name) |>
summarize(mean_value = mean(analyte_value, na.rm = TRUE)) |>
ungroup() |>
slice_max(order_by = mean_value, n = 10)
# Improved bar plot
ggplot(public_water_top10, aes(x = fct_reorder(system_name, mean_value), y = mean_value, fill = mean_value)) +
geom_col() +
geom_text(aes(label = round(mean_value, 2)), hjust = -0.1, size = 3.5) +
coord_flip() +
scale_fill_viridis_c(option = "viridis", direction = -1) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 25)) +
labs(
title = "Top 10 Public Water Systems by Mean PFAS",
x = "Public Water System",
y = "Mean PFAS (ng/L)",
fill = "Mean PFAS",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold"),
legend.position = "none"
) +
expand_limits(y = max(public_water_top10$mean_value) * 1.1)
# County shapefile
counties_sf <- st_read("cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
select(GEOID, NAME)
# Converting geoid to character
surface_county <- surface_county |> mutate(geoid = as.character(geoid))
public_county  <- public_county  |> mutate(geoid = as.character(geoid))
sites_county   <- sites_county   |> mutate(geoid = as.character(geoid))
# Joining data sets
county_combined <- surface_county |>
full_join(public_county, by = "geoid") |>
full_join(sites_county, by = "geoid")
# Summary tables
county_summary <- county_combined |>
left_join(counties_sf, by = c("geoid" = "GEOID")) |>
relocate(NAME, .before = geoid) |>
select(NAME, mean_surface, n_surface_samples, mean_public, n_public_samples, n_sites) |>
arrange(desc(mean_surface))
# Flextable for first 10 counties
top10_county_table <- county_summary |> slice_head(n = 10)
flextable(top10_county_table) |> autofit()
# Faceted bar for the top 10 counties
county_long <- top10_county_table |>
pivot_longer(cols = c(mean_surface, mean_public, n_sites),
names_to = "metric", values_to = "value") |>
group_by(metric) |>
mutate(NAME = reorder(NAME, value)) |>
ungroup()
# Custom y-axis labels for each metric
metric_labels <- c(
mean_surface = "Mean Surface PFAS (ng/L)",
mean_public = "Mean Public PFAS (ng/L)",
n_sites = "Number of PFAS Sites")
county_long |>
ggplot(aes(x = NAME, y = value, fill = metric)) +
geom_col(show.legend = FALSE) +
geom_text(aes(label = round(value, 2)),
hjust = -0.1, size = 4, color = "black") +
facet_wrap(~ metric, scales = "free_y", labeller = labeller(metric = metric_labels)) +
coord_flip(clip = "off") +
scale_fill_manual(values = c("steelblue", "tomato", "darkgreen")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)), breaks = NULL) +
labs(x = "County",
y = NULL,  # removing the y-axis title
title = "Top 10 Counties by Metric: Surface & Public PFAS and Number of Sites",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE") +
theme_minimal() |>
theme(plot.title = element_text(size = 14, face = "bold"),
plot.caption = element_text(size = 10, face = "bold"),
axis.text.y = element_text(face = "bold"))
