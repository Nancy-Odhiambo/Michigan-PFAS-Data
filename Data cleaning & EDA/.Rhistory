# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "cividis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 9))
# Plotting PFAS sites by type with Hazard_Index > 1
# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "viridis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 9))
# Plotting PFAS sites by type with Hazard_Index > 1
# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "viridis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 10))
# Plotting PFAS sites by type with Hazard_Index > 1
# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "viridis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 10))
# Plotting the pfas sites with hazard index greater than 1 as per regulations
# Convert geoid to character for joining
pfas_sites <- pfas_sites |>
mutate(geoid = as.character(geoid))
# Join datasets allowing many-to-many
merged_data <- public_water_max_long |>
left_join(pfas_sites, by = "geoid", relationship = "many-to-many")
# Aggregating to one row per hex_id for mapping
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Selecting the correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Plot with color and size for Hazard_Index
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf, aes(color = Hazard_Index, size = Hazard_Index)) +
scale_color_viridis_c(option = "viridis") +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Hazard Index size and scale",
color = "Hazard Index",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right")
# Plotting the pfas sites with hazard index greater than 1 as per regulations
# Convert geoid to character for joining
pfas_sites <- pfas_sites |>
mutate(geoid = as.character(geoid))
# Join datasets allowing many-to-many
merged_data <- public_water_max_long |>
left_join(pfas_sites, by = "geoid", relationship = "many-to-many")
# Aggregating to one row per hex_id for mapping
hazard_sites <- merged_data |>
filter(Hazard_Index > 1) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Selecting the correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Plot with color and size for Hazard_Index
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf, aes(color = Hazard_Index, size = Hazard_Index)) +
scale_color_viridis_c(option = "viridis") +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Hazard Index size and scale",
color = "Hazard Index",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right")
# Plot showing the pfas sites in Michigan
pfas_sites_sf <- pfas_sites |>
st_as_sf(coords = c("longitude", "latitude"), crs = 4326) |>
mutate(type = str_replace_all(type, "mlitary", "military"),
type = str_to_title(type))
ggplot() +
geom_sf(data = mi_counties, fill = "grey90", color = "white") +
geom_sf(data = pfas_sites_sf, aes(color = type), size = 1.5, alpha = 0.7) +
scale_color_viridis_d() +
labs(
title = "PFAS Sites Across Michigan",
color = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART), EGLE"
) +
theme_minimal()
# Map of Hazard index distribution in Michigan
# Load Michigan counties shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
high_hazard_sites <- public_water_max_long |>
filter(Hazard_Index > 1) |>
distinct(hex_id, longitude, latitude, Hazard_Index, system_name, system_type)
# Convert to sf object using longitude and latitude
high_hazard_sf <- st_as_sf(high_hazard_sites, coords = c("longitude", "latitude"), crs = 4326)
ggplot() +
geom_sf(data = mi_counties, fill = "grey", color = "black") +
geom_sf(data = high_hazard_sf, aes(size = Hazard_Index), color = "mediumseagreen", alpha = 0.7) +
scale_size_continuous(range = c(2, 8)) +
labs(title = "Michigan Public Water Locations with Hazard Index > 1",
size = "Hazard Index",
x = "Longitude",
y = "Latitude",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme_minimal() +
theme(legend.position = "right",
axis.text = element_text(color = "black"),
axis.ticks = element_line(color = "black"))
# Plot of counties with hazard index > 1
# Aggregate Hazard Index by county
county_hazard <- public_water_max |>
filter(Hazard_Index > 1) |>
distinct(hex_id, Hazard_Index, geoid) |>  # one hazard index per site
group_by(geoid) |>
summarise(total_hazard = sum(Hazard_Index, na.rm = TRUE)) |>
ungroup() |>
left_join(st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
st_drop_geometry() |>
dplyr::select(GEOID, NAME, STATEFP),
by = c("geoid" = "GEOID")) |>
filter(!is.na(NAME))
# Bar plot of counties which have high hazard index
county_hazard |>
ggplot(aes(x = reorder(NAME, total_hazard), y = total_hazard, fill = total_hazard)) +
geom_col() +
coord_flip() +
labs(title = "Public Water Locations with Hazard Index > 1 by County",
x = "County",
y = "Total Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
scale_fill_viridis_c(option = "viridis") +
theme_minimal()
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, Hazard_Index)
# Aggregate mean Hazard_Index by site type
mean_by_type <- hazard_data |>
group_by(type) |>
summarise(mean_hazard = mean(Hazard_Index, na.rm = TRUE),
.groups = "drop")
# Order types by mean hazard descending
top_types <- mean_by_type |>
arrange(desc(mean_hazard)) |>
slice_head(n = 10)
# Prepare plot data with factor levels for ordering
plot_data <- mean_by_type |>
filter(type %in% top_types$type) |>
mutate(type = factor(type, levels = top_types$type))
# Plot mean Hazard_Index by site type
ggplot(plot_data, aes(x = type, y = mean_hazard, fill = type)) +
geom_col(position = position_dodge(width = 0.7), width = 0.7) +
scale_fill_viridis_d(option = "plasma") +
labs(title = "Mean Hazard Index by Site Type (Hazard_Index > 1)",
x = "Site Type",
y = "Mean Hazard Index",
fill = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, Hazard_Index)
# Aggregate mean Hazard_Index by site type
mean_by_type <- hazard_data |>
group_by(type) |>
summarise(mean_hazard = mean(Hazard_Index, na.rm = TRUE),
.groups = "drop")
# Order types by mean hazard descending
top_types <- mean_by_type |>
arrange(desc(mean_hazard)) |>
slice_head(n = 10)
# Prepare plot data with factor levels for ordering
plot_data <- mean_by_type |>
filter(type %in% top_types$type) |>
mutate(type = factor(type, levels = top_types$type))
# Plot mean Hazard_Index by site type
ggplot(plot_data, aes(x = type, y = mean_hazard, fill = type)) +
geom_col(position = position_dodge(width = 0.7), width = 0.7) +
scale_fill_viridis_d(option = "viridis") +
labs(title = "Mean Hazard Index by Site Type (Hazard_Index > 1)",
x = "Site Type",
y = "Mean Hazard Index",
fill = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
View(pfas_sites)
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, Hazard_Index)
# Aggregate mean Hazard_Index and count of sites by site type
mean_by_type <- hazard_data |>
group_by(type) |>
summarise(mean_hazard = mean(Hazard_Index, na.rm = TRUE),
n_sites = n(),
.groups = "drop")
# Order types by mean hazard descending
top_types <- mean_by_type |>
arrange(desc(mean_hazard)) |>
slice_head(n = 10)
# Prepare plot data with factor levels for ordering
plot_data <- mean_by_type |>
filter(type %in% top_types$type) |>
mutate(type = factor(type, levels = top_types$type))
# Plot mean Hazard_Index by site type with site count labels
ggplot(plot_data, aes(x = type, y = mean_hazard, fill = type)) +
geom_col(position = position_dodge(width = 0.7), width = 0.7) +
geom_text(aes(label = n_sites), vjust = -0.5, size = 3.5) +
scale_fill_viridis_d(option = "viridis") +
labs(title = "Mean Hazard Index by Site Type (Hazard_Index > 1)",
x = "Site Type",
y = "Mean Hazard Index",
fill = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART)",
subtitle = "Numbers above bars indicate number of sites per type") +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
group_by(hex_id) |>
slice_max(order_by = Hazard_Index, n = 1, with_ties = FALSE) |>
ungroup()
hazard_summary_by_type <- hazard_data |>
group_by(type) |>
summarise(
total_hazard = sum(Hazard_Index, na.rm = TRUE),
sum_HFPODA = sum(HFPODAResult, na.rm = TRUE),
sum_PFNA   = sum(PFNAResult, na.rm = TRUE),
sum_PFBS   = sum(PFBSResult, na.rm = TRUE),
sum_PFHxS  = sum(PFHxSResult, na.rm = TRUE),
n_sites    = n(),
.groups = "drop"
) |>
arrange(desc(total_hazard))
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
group_by(hex_id) |>
slice_max(order_by = Hazard_Index, n = 1, with_ties = FALSE) |>
ungroup()
hazard_summary_by_type <- hazard_data |>
group_by(type) |>
summarise(
total_hazard = sum(Hazard_Index, na.rm = TRUE),
sum_HFPODA = sum(HFPODA, na.rm = TRUE),
sum_PFNA   = sum(PFNA, na.rm = TRUE),
sum_PFBS   = sum(PFBS, na.rm = TRUE),
sum_PFHxS  = sum(PFHxS, na.rm = TRUE),
n_sites    = n(),
.groups = "drop"
) |>
arrange(desc(total_hazard))
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, analyte, analyte_value, Hazard_Index)  # one row per hex_id-analyte
# Summarise total hazard and analyte sums by type
hazard_summary_by_type <- hazard_data |>
group_by(type, analyte) |>
summarise(
sum_analyte = sum(analyte_value, na.rm = TRUE),
.groups = "drop"
) |>
# Add total hazard per type
left_join(
hazard_data |>
group_by(type) |>
summarise(total_hazard = sum(Hazard_Index, na.rm = TRUE),
n_sites = n_distinct(hex_id),
.groups = "drop"),
by = "type"
) |>
arrange(desc(total_hazard))
# View as a table
hazard_summary_by_type |>
flextable() |>
set_caption("Total Hazard and Analyte Distribution by Site Type (Hazard_Index > 1, long format)") |>
autofit()
# Filter merged_data for Hazard_Index > 1, remove NA types, keep only main analytes
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, analyte, analyte_value, Hazard_Index) |>
filter(analyte %in% hazard_analytes)  # use your existing hazard_analytes object
# Summarise total hazard and analyte sums by type
hazard_summary_by_type <- hazard_data |>
group_by(type, analyte) |>
summarise(
sum_analyte = sum(analyte_value, na.rm = TRUE),
.groups = "drop"
) |>
# Add total hazard per type
left_join(
hazard_data |>
group_by(type) |>
summarise(total_hazard = sum(Hazard_Index, na.rm = TRUE),
n_sites = n_distinct(hex_id),
.groups = "drop"),
by = "type"
) |>
arrange(desc(total_hazard))
# View as a table
hazard_summary_by_type |>
flextable() |>
set_caption("Total Hazard and Main Analytes Distribution by Site Type (Hazard_Index > 1)") |>
autofit()
# Filter merged_data for Hazard_Index > 1 and remove NA types
hazard_data <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
distinct(hex_id, type, Hazard_Index)
# Aggregate mean Hazard_Index and count of sites by site type
mean_by_type <- hazard_data |>
group_by(type) |>
summarise(mean_hazard = mean(Hazard_Index, na.rm = TRUE),
n_sites = n(),
.groups = "drop")
# Order types by mean hazard descending
top_types <- mean_by_type |>
arrange(desc(mean_hazard)) |>
slice_head(n = 10)
# Prepare plot data with factor levels for ordering
plot_data <- mean_by_type |>
filter(type %in% top_types$type) |>
mutate(type = factor(type, levels = top_types$type))
# Plot mean Hazard_Index by site type with site count labels
ggplot(plot_data, aes(x = type, y = mean_hazard, fill = type)) +
geom_col(position = position_dodge(width = 0.7), width = 0.7) +
geom_text(aes(label = n_sites), vjust = -0.5, size = 3.5) +
scale_fill_viridis_d(option = "viridis") +
labs(title = "Mean Hazard Index by Site Type (Hazard_Index > 1)",
x = "Site Type",
y = "Mean Hazard Index",
fill = "Site Type",
caption = "Data source: Michigan PFAS Action Response Team (MPART)",
subtitle = "Numbers above bars indicate number of sites per type") +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
# Plotting PFAS sites by type with Hazard_Index > 1
# Filter for Hazard_Index strictly greater than 1
hazard_sites <- merged_data |>
filter(Hazard_Index > 1, !is.na(type)) |>
group_by(hex_id) |>
slice(1) |>
ungroup()
# Select correct longitude/latitude columns
hazard_sites <- hazard_sites |>
rename(lon = longitude.x,
lat = latitude.x)
# Convert to sf object
hazard_sites_sf <- hazard_sites |>
st_as_sf(coords = c("lon", "lat"), crs = 4326)
# Load Michigan shapefile
mi_counties <- st_read("GeoFiles/cb_2018_us_county_500k.shp") |>
filter(STATEFP == "26")
# Map showing site type and degree of hazard
ggplot() +
geom_sf(data = mi_counties, fill = "lightgrey", color = "black") +
geom_sf(data = hazard_sites_sf,
aes(color = type, size = Hazard_Index),
alpha = 0.8) +
scale_color_viridis_d(option = "viridis", direction = -1) +
scale_size_continuous(range = c(2,6)) +
coord_sf(xlim = c(-90, -82), ylim = c(41, 48)) +
theme_minimal() +
labs(title = "PFAS Sites in Michigan by Type and Hazard Index (>1)",
color = "Site Type",
size = "Hazard Index",
caption = "Data source: Michigan PFAS Action Response Team (MPART)") +
theme(legend.position = "right",
legend.title = element_text(face = "bold"),
legend.text = element_text(size = 10))
